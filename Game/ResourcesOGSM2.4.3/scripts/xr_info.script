----------------------------------------------------------------------------------------------------------------------
--	Выдача информации сталкерам.
--	автор: Диденко Руслан (Stohe)
--	TODO: 
----------------------------------------------------------------------------------------------------------------------

local info_by_community = {

			stalker = {
						"encyclopedy_zone_zone-story_story-2006",
						"encyclopedy_zone_zone-story_story-2008",
						"encyclopedy_zone_zone-story_story-2010",
						"encyclopedy_zone_zone-story_story-raid",
						"encyclopedy_zone_surge",
						"encyclopedy_zone_psy",
						"encyclopedy_zone_anomalies_bald",
						"encyclopedy_zone_anomalies_gravi",
						"encyclopedy_zone_anomalies_meat",
						"encyclopedy_zone_anomalies_zharka",
						"encyclopedy_zone_anomalies_electra",
						"encyclopedy_zone_anomalies_fuzz",
						"encyclopedy_zone_anomalies_radioactive",
						"encyclopedy_zone_anomalies_ameba",
						"l01_escape_level_info",
						"l02_garbage_level_info",
						"l03_agroprom_level_info",
						"l04_darkvalley_level_info",
						"l05_bar_level_info",
						"l06_rostok_level_info",
						"l07_military_level_info",
						"l08_yantar_level_info",
						"l10_radar_level_info",
						"l11_pripyat_level_info",
						"l12_stancia_level_info",
						"encyclopedy_mutant_crow_general",
						"encyclopedy_social_stalker-clans_loners",
						"stalker_story_1",
						"stalker_story_2",
						"stalker_story_3",
						"stalker_story_4",
						"stalker_story_5",
						"stalker_story_6",
						"stalker_story_7",
						"stalker_story_8",
						"stalker_story_9",
						"stalker_story_10",
						"stalker_story_12",
						"stalker_story_13",
						"stalker_story_14",
						"stalker_story_15"},
	
			monolith = {
						"encyclopedy_zone_zone-story_story-2006",
						"encyclopedy_zone_zone-story_story-2008",
						"encyclopedy_zone_zone-story_story-2010",
						"encyclopedy_zone_zone-story_story-raid",
						"encyclopedy_zone_surge",
						"encyclopedy_zone_psy",
						"encyclopedy_zone_anomalies_bald",
						"encyclopedy_zone_anomalies_gravi",
						"encyclopedy_zone_anomalies_meat",
						"encyclopedy_zone_anomalies_zharka",
						"encyclopedy_zone_anomalies_electra",
						"encyclopedy_zone_anomalies_fuzz",
						"encyclopedy_zone_anomalies_radioactive",
						"encyclopedy_zone_anomalies_ameba",
						"l01_escape_level_info",
						"l02_garbage_level_info",
						"l03_agroprom_level_info",
						"l04_darkvalley_level_info",
						"l05_bar_level_info",
						"l06_rostok_level_info",
						"l07_military_level_info",
						"l08_yantar_level_info",
						"l10_radar_level_info",
						"l11_pripyat_level_info",
						"l12_stancia_level_info",
						"encyclopedy_mutant_crow_general",
						"encyclopedy_social_stalker-clans_monolith",
						"stalker_story_16",
						"stalker_story_17",
						"stalker_story_18",
						"stalker_story_19",
						"stalker_story_20"},
	
			military = {
						"encyclopedy_zone_zone-story_story-2006",
						"encyclopedy_zone_zone-story_story-2008",
						"encyclopedy_zone_zone-story_story-2010",
						"encyclopedy_zone_zone-story_story-raid",
						"encyclopedy_zone_surge",
						"encyclopedy_zone_psy",
						"encyclopedy_zone_anomalies_bald",
						"encyclopedy_zone_anomalies_gravi",
						"encyclopedy_zone_anomalies_meat",
						"encyclopedy_zone_anomalies_zharka",
						"encyclopedy_zone_anomalies_electra",
						"encyclopedy_zone_anomalies_fuzz",
						"encyclopedy_zone_anomalies_radioactive",
						"encyclopedy_zone_anomalies_ameba",
						"l01_escape_level_info",
						"l02_garbage_level_info",
						"l03_agroprom_level_info",
						"l04_darkvalley_level_info",
						"l05_bar_level_info",
						"l06_rostok_level_info",
						"l07_military_level_info",
						"l08_yantar_level_info",
						"l10_radar_level_info",
						"l11_pripyat_level_info",
						"l12_stancia_level_info",
						"encyclopedy_mutant_crow_general",
						"encyclopedy_social_military_army",
						"encyclopedy_social_military_milstalkers",
						"stalker_story_1",
						"stalker_story_2",
						"stalker_story_3",
						"stalker_story_10"},
	
			killer = {
						"encyclopedy_zone_zone-story_story-2006",
						"encyclopedy_zone_zone-story_story-2008",
						"encyclopedy_zone_zone-story_story-2010",
						"encyclopedy_zone_zone-story_story-raid",
						"encyclopedy_zone_surge",
						"encyclopedy_zone_psy",
						"encyclopedy_zone_anomalies_bald",
						"encyclopedy_zone_anomalies_gravi",
						"encyclopedy_zone_anomalies_meat",
						"encyclopedy_zone_anomalies_zharka",
						"encyclopedy_zone_anomalies_electra",
						"encyclopedy_zone_anomalies_fuzz",
						"encyclopedy_zone_anomalies_radioactive",
						"encyclopedy_zone_anomalies_ameba",
						"l01_escape_level_info",
						"l02_garbage_level_info",
						"l03_agroprom_level_info",
						"l04_darkvalley_level_info",
						"l05_bar_level_info",
						"l06_rostok_level_info",
						"l07_military_level_info",
						"l08_yantar_level_info",
						"l10_radar_level_info",
						"l11_pripyat_level_info",
						"l12_stancia_level_info",
						"encyclopedy_mutant_crow_general",
						"encyclopedy_social_stalker-clans_killers",
						"stalker_story_1",
						"stalker_story_2",
						"stalker_story_4",
						"stalker_story_5",
						"stalker_story_7",
						"stalker_story_10",
						"stalker_story_12",
						"stalker_story_13",
						"stalker_story_14",
						"stalker_story_15"},
	
			ecolog = {
						"encyclopedy_zone_zone-story_story-2006",
						"encyclopedy_zone_zone-story_story-2008",
						"encyclopedy_zone_zone-story_story-2010",
						"encyclopedy_zone_zone-story_story-raid",
						"encyclopedy_zone_surge",
						"encyclopedy_zone_psy",
						"encyclopedy_zone_anomalies_bald",
						"encyclopedy_zone_anomalies_gravi",
						"encyclopedy_zone_anomalies_meat",
						"encyclopedy_zone_anomalies_zharka",
						"encyclopedy_zone_anomalies_electra",
						"encyclopedy_zone_anomalies_fuzz",
						"encyclopedy_zone_anomalies_radioactive",
						"encyclopedy_zone_anomalies_ameba",
						"l01_escape_level_info",
						"l02_garbage_level_info",
						"l03_agroprom_level_info",
						"l04_darkvalley_level_info",
						"l05_bar_level_info",
						"l06_rostok_level_info",
						"l07_military_level_info",
						"l08_yantar_level_info",
						"l10_radar_level_info",
						"l11_pripyat_level_info",
						"l12_stancia_level_info",
						"encyclopedy_mutant_crow_general",
						"encyclopedy_social_scientists_mobile-labs"},
	
			dolg = {
						"encyclopedy_zone_zone-story_story-2006",
						"encyclopedy_zone_zone-story_story-2008",
						"encyclopedy_zone_zone-story_story-2010",
						"encyclopedy_zone_zone-story_story-raid",
						"encyclopedy_zone_surge",
						"encyclopedy_zone_psy",
						"encyclopedy_zone_anomalies_bald",
						"encyclopedy_zone_anomalies_gravi",
						"encyclopedy_zone_anomalies_meat",
						"encyclopedy_zone_anomalies_zharka",
						"encyclopedy_zone_anomalies_electra",
						"encyclopedy_zone_anomalies_fuzz",
						"encyclopedy_zone_anomalies_radioactive",
						"encyclopedy_zone_anomalies_ameba",
						"l01_escape_level_info",
						"l02_garbage_level_info",
						"l03_agroprom_level_info",
						"l04_darkvalley_level_info",
						"l05_bar_level_info",
						"l06_rostok_level_info",
						"l07_military_level_info",
						"l08_yantar_level_info",
						"l10_radar_level_info",
						"l11_pripyat_level_info",
						"l12_stancia_level_info",
						"encyclopedy_mutant_crow_general",
						"encyclopedy_social_stalker-clans_duty",
						"stalker_story_1",
						"stalker_story_2",
						"stalker_story_4",
						"stalker_story_5",
						"stalker_story_6",
						"stalker_story_8",
						"stalker_story_9",
						"stalker_story_10",
						"stalker_story_12",
						"stalker_story_13"},
	
			freedom = {
						"encyclopedy_zone_zone-story_story-2006",
						"encyclopedy_zone_zone-story_story-2008",
						"encyclopedy_zone_zone-story_story-2010",
						"encyclopedy_zone_zone-story_story-raid",
						"encyclopedy_zone_surge",
						"encyclopedy_zone_psy",
						"encyclopedy_zone_anomalies_bald",
						"encyclopedy_zone_anomalies_gravi",
						"encyclopedy_zone_anomalies_meat",
						"encyclopedy_zone_anomalies_zharka",
						"encyclopedy_zone_anomalies_electra",
						"encyclopedy_zone_anomalies_fuzz",
						"encyclopedy_zone_anomalies_radioactive",
						"encyclopedy_zone_anomalies_ameba",
						"l01_escape_level_info",
						"l02_garbage_level_info",
						"l03_agroprom_level_info",
						"l04_darkvalley_level_info",
						"l05_bar_level_info",
						"l06_rostok_level_info",
						"l07_military_level_info",
						"l08_yantar_level_info",
						"l10_radar_level_info",
						"l11_pripyat_level_info",
						"l12_stancia_level_info",
						"encyclopedy_mutant_crow_general",
						"encyclopedy_social_stalker-clans_freedom",
						"stalker_story_1",
						"stalker_story_2",
						"stalker_story_3",
						"stalker_story_4",
						"stalker_story_5",
						"stalker_story_6",
						"stalker_story_7",
						"stalker_story_8",
						"stalker_story_9",
						"stalker_story_10",
						"stalker_story_12",
						"stalker_story_13",
						"stalker_story_14",
						"stalker_story_15"},
	
			bandit = {
						"encyclopedy_zone_zone-story_story-2006",
						"encyclopedy_zone_zone-story_story-2008",
						"encyclopedy_zone_zone-story_story-2010",
						"encyclopedy_zone_zone-story_story-raid",
						"encyclopedy_zone_surge",
						"encyclopedy_zone_psy",
						"encyclopedy_zone_anomalies_bald",
						"encyclopedy_zone_anomalies_gravi",
						"encyclopedy_zone_anomalies_meat",
						"encyclopedy_zone_anomalies_zharka",
						"encyclopedy_zone_anomalies_electra",
						"encyclopedy_zone_anomalies_fuzz",
						"encyclopedy_zone_anomalies_radioactive",
						"encyclopedy_zone_anomalies_ameba",
						"l01_escape_level_info",
						"l02_garbage_level_info",
						"l03_agroprom_level_info",
						"l04_darkvalley_level_info",
						"l05_bar_level_info",
						"l06_rostok_level_info",
						"l07_military_level_info",
						"l08_yantar_level_info",
						"l10_radar_level_info",
						"l11_pripyat_level_info",
						"l12_stancia_level_info",
						"encyclopedy_mutant_crow_general",
						"encyclopedy_social_stalker-clans_bandits",
						"stalker_story_10",
						"stalker_story_11",
						"stalker_story_12"},
	
			zombied = {
						"encyclopedy_social_stalker-clans_zomstalkers"}

		}


local info_by_rank = {

		novice = {
					"encyclopedy_zone_zone-story_story-2006",
					"encyclopedy_zone_anomalies_bald",
					"encyclopedy_zone_anomalies_gravi",
					"encyclopedy_zone_anomalies_meat",
					"encyclopedy_zone_anomalies_electra",
					"encyclopedy_zone_anomalies_radioactive",
					"l01_escape_level_info",
					"l02_garbage_level_info",
					"l03_agroprom_level_info",
					"l04_darkvalley_level_info",
					"l05_bar_level_info",
					"l06_rostok_level_info",
					"l07_military_level_info",
					"l08_yantar_level_info",
					"l10_radar_level_info",
					"l11_pripyat_level_info",
					"l12_stancia_level_info",
					"encyclopedy_mutant_crow_general",
					"encyclopedy_social_military_army",
					"encyclopedy_social_scientists_mobile-labs",
					"encyclopedy_social_stalker-clans_duty",
					"encyclopedy_social_stalker-clans_freedom",
					"encyclopedy_social_stalker-clans_monolith",
					"encyclopedy_social_stalker-clans_zomstalkers",
					"encyclopedy_social_stalker-clans_bandits",
					"encyclopedy_social_stalker-clans_killers",
					"encyclopedy_social_stalker-clans_loners"
					},

		stalker = {
					"encyclopedy_zone_zone-story_story-2008",
					"encyclopedy_zone_surge",
					"encyclopedy_zone_psy",
					"encyclopedy_zone_anomalies_fuzz",
					"encyclopedy_zone_anomalies_radioactive",
					"encyclopedy_zone_anomalies_electra",
					"encyclopedy_zone_anomalies_ameba",
					"l01_escape_level_info",
					"l02_garbage_level_info",
					"l03_agroprom_level_info",
					"l04_darkvalley_level_info",
					"l05_bar_level_info",
					"l06_rostok_level_info",
					"l07_military_level_info",
					"l08_yantar_level_info",
					"l10_radar_level_info",
					"l11_pripyat_level_info",
					"l12_stancia_level_info",
					"encyclopedy_social_military_army",
					"encyclopedy_social_scientists_mobile-labs",
					"encyclopedy_social_stalker-clans_duty",
					"encyclopedy_social_stalker-clans_freedom",
					"encyclopedy_social_stalker-clans_monolith",
					"encyclopedy_social_stalker-clans_zomstalkers",
					"encyclopedy_social_stalker-clans_bandits",
					"encyclopedy_social_stalker-clans_killers",
					"encyclopedy_social_stalker-clans_loners",
					"stalker_story_1",
					"stalker_story_2",
					"stalker_story_3",
					"stalker_story_4",
					"stalker_story_5",
					"stalker_story_6",
					"stalker_story_7",
					"stalker_story_8",
					"stalker_story_9",
					"stalker_story_10",
					"stalker_story_11",
					"stalker_story_12",
					"stalker_story_13",
					"stalker_story_14",
					"stalker_story_15",
					"stalker_story_16",
					"stalker_story_17",
					"stalker_story_18",
					"stalker_story_19",
					"stalker_story_20"
					},

		veteran = {
					"encyclopedy_zone_zone-story_story-2010",
					"encyclopedy_zone_zone-story_story-raid",
					"encyclopedy_zone_surge",
					"encyclopedy_zone_psy",
					"encyclopedy_zone_anomalies_fuzz",
					"encyclopedy_zone_anomalies_radioactive",
					"encyclopedy_zone_anomalies_electra",
					"encyclopedy_zone_anomalies_ameba",
					"l01_escape_level_info",
					"l02_garbage_level_info",
					"l03_agroprom_level_info",
					"l04_darkvalley_level_info",
					"l05_bar_level_info",
					"l06_rostok_level_info",
					"l07_military_level_info",
					"l08_yantar_level_info",
					"l10_radar_level_info",
					"l11_pripyat_level_info",
					"l12_stancia_level_info",
					"encyclopedy_social_stalker-clans_loners",
					"encyclopedy_social_military_army",
					"encyclopedy_social_military_milstalkers",
					"encyclopedy_social_scientists_mobile-labs",
					"encyclopedy_social_stalker-clans_duty",
					"encyclopedy_social_stalker-clans_freedom",
					"encyclopedy_social_stalker-clans_monolith",
					"encyclopedy_social_stalker-clans_zomstalkers",
					"encyclopedy_social_stalker-clans_bandits",
					"encyclopedy_social_stalker-clans_killers",
					"encyclopedy_social_stalker-clans_loners",
					"stalker_story_1",
					"stalker_story_2",
					"stalker_story_3",
					"stalker_story_4",
					"stalker_story_5",
					"stalker_story_6",
					"stalker_story_7",
					"stalker_story_8",
					"stalker_story_9",
					"stalker_story_10",
					"stalker_story_11",
					"stalker_story_12",
					"stalker_story_13",
					"stalker_story_14",
					"stalker_story_15",
					"stalker_story_16",
					"stalker_story_17",
					"stalker_story_18",
					"stalker_story_19",
					"stalker_story_20"
					},

		master = {
					"encyclopedy_zone_zone-story_story-raid",
					"encyclopedy_zone_surge",
					"encyclopedy_zone_psy",
					"encyclopedy_zone_anomalies_fuzz",
					"encyclopedy_zone_anomalies_radioactive",
					"encyclopedy_zone_anomalies_electra",
					"encyclopedy_zone_anomalies_ameba",
					"l01_escape_level_info",
					"l02_garbage_level_info",
					"l03_agroprom_level_info",
					"l04_darkvalley_level_info",
					"l05_bar_level_info",
					"l06_rostok_level_info",
					"l07_military_level_info",
					"l08_yantar_level_info",
					"l10_radar_level_info",
					"l11_pripyat_level_info",
					"l12_stancia_level_info",
					"encyclopedy_social_military_army",
					"encyclopedy_social_military_milstalkers",
					"encyclopedy_social_scientists_mobile-labs",
					"encyclopedy_social_stalker-clans_duty",
					"encyclopedy_social_stalker-clans_freedom",
					"encyclopedy_social_stalker-clans_monolith",
					"encyclopedy_social_stalker-clans_zomstalkers",
					"encyclopedy_social_stalker-clans_bandits",
					"encyclopedy_social_stalker-clans_killers",
					"encyclopedy_social_stalker-clans_loners",
					"stalker_story_1",
					"stalker_story_2",
					"stalker_story_3",
					"stalker_story_4",
					"stalker_story_5",
					"stalker_story_6",
					"stalker_story_7",
					"stalker_story_8",
					"stalker_story_9",
					"stalker_story_10",
					"stalker_story_11",
					"stalker_story_12",
					"stalker_story_13",
					"stalker_story_14",
					"stalker_story_15",
					"stalker_story_16",
					"stalker_story_17",
					"stalker_story_18",
					"stalker_story_19",
					"stalker_story_20"
					}
		}


function loadInfo(npc, char_ini)
	-- Загрузка из кастом даты
	if char_ini:section_exist("known_info") then
		local n = char_ini:line_count("known_info")
		local result, id, value = 0,"",""
	
		for i=0,n-1 do
			result, id, value = char_ini:r_line("known_info",i,"","")

			give_npc_info(npc, id)
		end
	end
	
	
	-- Загрузка из генератора.
	local community_info = info_by_community[npc:character_community()]
	if community_info == nil then
		return
	end
	
	local rank = ranks.get_obj_rank_name(npc)
	local rank_info = info_by_rank[rank]
	if rank_info == nil then
		return
	end

	local tt = {}
	-- оставляем инфопоршны, которые есть и там и там.
	for k,v in pairs(community_info) do
		for kk,vv in pairs(rank_info) do
			if v == vv and not has_alife_info(v) then
				if not string.find(v, "level_info") then
					-- Добавляем в список доступных знаний
					table.insert(tt, v)
					break
				else
					if v == level.name().."_level_info" then
						table.insert(tt, v)
						break
					end
				end
			end
		end	
	end

	local size = table.getn(tt)
	for k = 1,math.min(size,3) do	
		if math.random(100) >= 50 then
			local ii = tt[math.random(size)]
			give_npc_info(npc, ii)
		end
	end
end

function give_npc_info(npc, info)
	-- Даем НПС инфопоршны
	npc:give_info_portion(info)

	-- Проверяем есть ли озвученная история на этот инфопоршн, и если есть
	-- добавляем ее тоже
	if sound_theme.theme[info] ~= nil then
		if db.story_by_id[npc:id()] == nil then
			db.story_by_id[npc:id()] = {}
		end
		
		table.insert(db.story_by_id[npc:id()], info)
	end
end